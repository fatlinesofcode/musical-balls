var loadCssUrl=function(a){var b=$("<link>");b.attr({type:"text/css",rel:"stylesheet",href:a});$("head").append(b)};var FBservice=function(){var a=this;a.debugMode=!1;a.initialized=!1;a.connected=!1;a.userID=null;a.accessToken=null;a.userProfile=null;a.premissions="";a.useImageProxy=!1;a.imageProxyUrl=ROOT_PATH+"photo/facebook/";a.init=function(c){window.fbApiInitialized?(a.initialized=!0,c&&c(),FB.Event.subscribe("auth.login",function(a){log("auth.login event handler",a)}),FB.Event.subscribe("auth.logout",function(a){log("auth.logout event handler",a)}),FB.Event.subscribe("auth.statusChange",function(a){log("auth.statusChange event handler",
a)}),FB.Event.subscribe("auth.authResponseChange",function(a){log("auth.authResponseChange event handler",a)})):setTimeout(function(){a.init(c)},50)};a.getLoginStatus=function(c){if(!a.initialized)throw Error("FBservice not initialized");FB.getLoginStatus(function(d){switch(d.status){case "not_authorized":a.connected=!1;break;case "connected":a.connected=!0,a.userID=d.authResponse.userID,a.accessToken=d.authResponse.accessToken}c(d)})};a.login=function(c){FB.login(function(a){b("FB.login with permissions callback",
a);c(a)},{scope:a.premissions})};a.loadProfile=function(c){return a.loadUserProfile("me",c)};a.loadUserProfile=function(c,d){c=c||"me";FB.api("/"+c,function(b){b.photos={};b.photos.square=a.getPhotoUrl(b.id,"square");b.photos.small=a.getPhotoUrl(b.id,"small");b.photos.normal=a.getPhotoUrl(b.id,"normal");b.photos.large=a.getPhotoUrl(b.id,"large");"me"==c&&(a.userProfile=b);d(b)})};a.loadFriends=function(c){if(!a.connected)throw Error("FBservice not connected/logged");FB.api({method:"friends.get"},
function(a){b("friends.get response",a);c(a)})};a.wallpost=function(c){return a.postDialog(c)};a.postDialog=function(a){a=a||{};a.from=a.from||null;a.to=a.to||null;a.name=a.name||null;a.link=a.link||null;a.picture=a.picture||null;a.caption=a.caption||" ";a.description=a.description||null;a.message=a.message||null;a.callback=a.callback||function(){};FB.ui({method:"feed",to:a.to,from:a.from,name:a.name,link:a.link,picture:a.picture,caption:a.caption,description:a.description,message:a.message},a.callback)};
a.getPhotoUrl=function(b,d){d=d||"square";return a.useImageProxy?a.imageProxyUrl+b+"/"+d:"http://graph.facebook.com/"+b+"/picture?type="+d};var b=function(){a.debugMode&&log("FBservice",arguments)};return a};var hitTest=function(a,b){return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)},getDistance=function(a,b,c,d){return Math.sqrt((a-c)*(a-c)+(b-d)*(b-d))},getTriangleSides=function(a,b){var c,d;d=a*(Math.PI/180);c=Math.sin(d)*b;return{x:~~(0<d?c/Math.tan(d):b),y:~~c,angle:a}},randomChance=function(a){return 0==parseInt(Math.random()*a+1)%a},rand=function(a,b){return Math.random()*(b-a)+a},randRange=function(a,b,c,d){a=Math.random()*(d-(c-b));a+=c;a>d&&(a-=b);return a},getAngle2=function(a,
b){var c=0;return c=Math.atan2(-(b.y-a.y),b.x-a.x)*(180/Math.PI)},getAngle=function(a,b,c,d){a=Math.atan2(a-b,c-d)*(180/Math.PI);return a=0>a?Math.abs(a):360-a};
